<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesian Sophiarch • Oracle of Light</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .horizons-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .horizon-tag {
            padding: 8px 16px;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
        }

        .horizon-tag.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .horizon-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .algorithm-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .algorithm-card {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .algorithm-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .algorithm-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .algorithm-card h4 {
            color: #764ba2;
            margin-bottom: 8px;
        }

        .algorithm-card p {
            font-size: 0.9em;
            color: #666;
        }

        .btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .forecast-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .forecast-summary h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
        }

        .summary-stat .label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .summary-stat .value {
            font-size: 1.5em;
            font-weight: 700;
        }

        .horizon-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .horizon-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .horizon-card h4 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .stat-value {
            font-weight: 600;
            color: #333;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee;
            border: 2px solid #fcc;
            color: #c33;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .insights-list {
            list-style: none;
            padding: 0;
        }

        .insights-list li {
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .recommendation-card.high {
            border-left-color: #f44336;
        }

        .recommendation-card.medium {
            border-left-color: #ff9800;
        }

        .recommendation-card.low {
            border-left-color: #4caf50;
        }

        .recommendation-card h5 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .badge.high {
            background: #ffebee;
            color: #c62828;
        }

        .badge.medium {
            background: #fff3e0;
            color: #e65100;
        }

        .badge.low {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        /* Wizard Modal Styles */
        .wizard-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .wizard-overlay.hidden {
            display: none;
        }

        .wizard-modal {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .wizard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
        }

        .wizard-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .wizard-header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .wizard-content {
            padding: 30px;
        }

        .wizard-step {
            display: none;
        }

        .wizard-step.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .wizard-step h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .wizard-step p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .example-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .example-box h4 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .example-box .good {
            color: #4caf50;
            font-weight: 600;
        }

        .example-box .bad {
            color: #f44336;
            font-weight: 600;
        }

        .tip-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .tip-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wizard-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .wizard-buttons button {
            flex: 1;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .wizard-btn-prev {
            background: #e0e0e0;
            color: #666;
        }

        .wizard-btn-prev:hover:not(:disabled) {
            background: #d0d0d0;
        }

        .wizard-btn-next {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .wizard-btn-next:hover {
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }

        .wizard-btn-skip {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .wizard-btn-skip:hover {
            background: #667eea;
            color: white;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e0e0e0;
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: #667eea;
            transform: scale(1.3);
        }

        .progress-dot.completed {
            background: #4caf50;
        }

        ul.wizard-list {
            list-style: none;
            padding: 0;
        }

        ul.wizard-list li {
            padding: 10px;
            margin: 8px 0;
            background: #f8f9fa;
            border-left: 3px solid #667eea;
            border-radius: 4px;
        }

        ul.wizard-list li strong {
            color: #764ba2;
        }

        .interpretation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .interpretation-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-top: 3px solid #667eea;
        }

        .interpretation-card h5 {
            color: #764ba2;
            margin-bottom: 8px;
        }

        .interpretation-card p {
            font-size: 0.9em;
            color: #666;
            margin: 0;
        }
    </style>
</head>
<body>
    <!-- Wizard Modal -->
    <div class="wizard-overlay" id="wizard-overlay">
        <div class="wizard-modal">
            <div class="wizard-header">
                <h2>🧙‍♂️ Forecast Wizard</h2>
                <p>Let's help you frame your forecasting question</p>
            </div>

            <div class="wizard-content">
                <!-- Progress Dots -->
                <div class="progress-dots">
                    <div class="progress-dot active" data-step="0"></div>
                    <div class="progress-dot" data-step="1"></div>
                    <div class="progress-dot" data-step="2"></div>
                    <div class="progress-dot" data-step="3"></div>
                    <div class="progress-dot" data-step="4"></div>
                </div>

                <!-- Step 1: Welcome -->
                <div class="wizard-step active" data-step="0">
                    <h3>Welcome to the Bayesian Sophiarch! 🎯</h3>
                    <p>
                        This tool performs <strong>probabilistic forecasting</strong> - it analyzes patterns and predicts
                        future trends with confidence scores and uncertainty ranges.
                    </p>

                    <div class="tip-box">
                        <h4>💡 What Can This Tool Do?</h4>
                        <p>
                            The Bayesian Sophiarch can forecast <strong>numerical trends over time</strong>. It works best when
                            you want to predict whether something will increase, decrease, or stay the same - and by how much.
                        </p>
                    </div>

                    <div class="example-box">
                        <h4>✅ Great Questions:</h4>
                        <ul class="wizard-list">
                            <li><strong>Trends:</strong> "Will our Q4 revenue trend upward or downward?"</li>
                            <li><strong>Markets:</strong> "What's the likely direction of tech stock prices?"</li>
                            <li><strong>Metrics:</strong> "How will user engagement change this month?"</li>
                            <li><strong>Business:</strong> "Will customer churn increase or decrease?"</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>❌ Not Ideal For:</h4>
                        <ul class="wizard-list">
                            <li>Yes/no questions: "Should we launch this product?" → Better: "What's the revenue trend if we launch?"</li>
                            <li>One-time events: "Will the meeting happen?" → Better: "What's the attendance trend?"</li>
                            <li>Non-numerical: "What color should our logo be?"</li>
                        </ul>
                    </div>

                    <p style="margin-top: 20px;">
                        <strong>Key Point:</strong> Frame your question as <em>"What direction and magnitude?"</em>
                        rather than <em>"Yes or no?"</em>
                    </p>
                </div>

                <!-- Step 2: Question Format -->
                <div class="wizard-step" data-step="1">
                    <h3>How to Frame Your Question 📝</h3>
                    <p>
                        The Bayesian Sophiarch analyzes <strong>trends and directions</strong>. It doesn't answer yes/no
                        questions directly - instead, it forecasts numerical changes and their likelihood.
                    </p>

                    <div class="tip-box">
                        <h4>💡 The Formula</h4>
                        <p>
                            Good forecasting questions follow this pattern:<br><br>
                            <strong>"[Metric/Variable] + [Direction/Change] + [Time Period]"</strong>
                        </p>
                    </div>

                    <div class="example-box">
                        <h4>✅ Well-Framed Examples:</h4>
                        <ul class="wizard-list">
                            <li>"Revenue trend for Q4 2025"</li>
                            <li>"Customer acquisition cost changes over next 3 months"</li>
                            <li>"Website traffic growth trajectory"</li>
                            <li>"Inventory turnover rate forecast"</li>
                            <li>"Employee retention trend analysis"</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>🔄 Transforming Yes/No to Trend Questions:</h4>
                        <ul class="wizard-list">
                            <li>
                                <span class="bad">❌ "Should we hire more engineers?"</span><br>
                                <span class="good">✅ "Engineering productivity trend with current team size"</span>
                            </li>
                            <li>
                                <span class="bad">❌ "Will the campaign succeed?"</span><br>
                                <span class="good">✅ "Campaign ROI forecast over next 30 days"</span>
                            </li>
                            <li>
                                <span class="bad">❌ "Is now a good time to expand?"</span><br>
                                <span class="good">✅ "Market demand growth in target region"</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Step 3: What Format -->
                <div class="wizard-step" data-step="2">
                    <h3>Input Format & Examples 📊</h3>
                    <p>
                        You can phrase your forecast in natural language. The system analyzes patterns in historical
                        data (real or synthetic) and projects future trends.
                    </p>

                    <div class="example-box">
                        <h4>✅ Perfect Input Examples:</h4>
                        <ul class="wizard-list">
                            <li><strong>Business:</strong> "Q4 sales performance forecast"</li>
                            <li><strong>Finance:</strong> "Cash flow trend analysis for next quarter"</li>
                            <li><strong>Operations:</strong> "Supply chain efficiency changes"</li>
                            <li><strong>Marketing:</strong> "Conversion rate optimization trajectory"</li>
                            <li><strong>Product:</strong> "User engagement metric forecast"</li>
                            <li><strong>HR:</strong> "Employee satisfaction score trend"</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <h4>💡 Tips for Best Results</h4>
                        <ul class="wizard-list">
                            <li><strong>Be specific:</strong> "Mobile app revenue" vs "revenue"</li>
                            <li><strong>Include context:</strong> "Post-launch user retention" vs "retention"</li>
                            <li><strong>Avoid absolutes:</strong> "Revenue trend" vs "Revenue will definitely increase"</li>
                            <li><strong>Focus on measurables:</strong> Things you can quantify</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>🎯 What Happens Next:</h4>
                        <p>
                            The system will:
                        </p>
                        <ul class="wizard-list">
                            <li>Generate or use historical data patterns</li>
                            <li>Run Bayesian machine learning algorithms</li>
                            <li>Produce forecasts for your selected time horizons (1 day, 1 week, 1 month, etc.)</li>
                            <li>Calculate confidence scores and uncertainty ranges</li>
                            <li>Provide actionable recommendations</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 4: Horizons -->
                <div class="wizard-step" data-step="3">
                    <h3>Time Horizons ⏰</h3>
                    <p>
                        Select how far into the future you want to forecast. You can choose multiple horizons
                        to see short-term vs long-term trends.
                    </p>

                    <div class="interpretation-grid">
                        <div class="interpretation-card">
                            <h5>1 Day (1d)</h5>
                            <p>Immediate trends. Best for daily operations and quick decisions.</p>
                        </div>
                        <div class="interpretation-card">
                            <h5>1 Week (1w)</h5>
                            <p>Short-term planning. Weekly performance tracking.</p>
                        </div>
                        <div class="interpretation-card">
                            <h5>1 Month (1m)</h5>
                            <p>Monthly forecasts. Budget planning and reviews.</p>
                        </div>
                        <div class="interpretation-card">
                            <h5>3 Months (3m)</h5>
                            <p>Quarterly projections. Strategic planning periods.</p>
                        </div>
                        <div class="interpretation-card">
                            <h5>6 Months (6m)</h5>
                            <p>Mid-term forecasts. Half-year business planning.</p>
                        </div>
                        <div class="interpretation-card">
                            <h5>1 Year (1y)</h5>
                            <p>Long-term trends. Annual strategic planning.</p>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>💡 Choosing Horizons</h4>
                        <ul class="wizard-list">
                            <li><strong>Single horizon:</strong> When you need one specific timeframe</li>
                            <li><strong>Multiple horizons:</strong> To see how certainty changes over time</li>
                            <li><strong>Mix short & long:</strong> Compare immediate vs strategic trends</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>📈 Recommended Combinations:</h4>
                        <ul class="wizard-list">
                            <li><strong>Quick Check:</strong> 1d, 1w (fast, high confidence)</li>
                            <li><strong>Standard:</strong> 1w, 1m, 3m (balanced view)</li>
                            <li><strong>Strategic:</strong> 1m, 3m, 6m, 1y (long-term planning)</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 5: Reading Results -->
                <div class="wizard-step" data-step="4">
                    <h3>Understanding Your Results 🎓</h3>
                    <p>
                        After running a forecast, you'll see several key metrics. Here's how to interpret them:
                    </p>

                    <div class="interpretation-grid">
                        <div class="interpretation-card">
                            <h5>📊 Overall Trend</h5>
                            <p><strong>Positive:</strong> Likely to increase<br>
                            <strong>Negative:</strong> Likely to decrease<br>
                            <strong>Neutral:</strong> Likely to stay stable</p>
                        </div>

                        <div class="interpretation-card">
                            <h5>🎯 Confidence Score</h5>
                            <p><strong>90%+:</strong> Very reliable<br>
                            <strong>70-90%:</strong> Reliable<br>
                            <strong>50-70%:</strong> Moderate uncertainty<br>
                            <strong>&lt;50%:</strong> High uncertainty</p>
                        </div>

                        <div class="interpretation-card">
                            <h5>📉 Mean Prediction</h5>
                            <p>The most likely value. Positive means growth, negative means decline. The number represents the magnitude of change.</p>
                        </div>

                        <div class="interpretation-card">
                            <h5>±️ Uncertainty</h5>
                            <p>The range of possible outcomes. Lower is better - means more certain prediction.</p>
                        </div>

                        <div class="interpretation-card">
                            <h5>🔢 Effective Samples</h5>
                            <p>Quality metric (450-500 is excellent). Shows how well the algorithm explored the solution space.</p>
                        </div>

                        <div class="interpretation-card">
                            <h5>💡 Key Insights</h5>
                            <p>Auto-generated findings about patterns, confidence, and algorithm performance.</p>
                        </div>
                    </div>

                    <div class="tip-box">
                        <h4>💡 Making Decisions from Forecasts</h4>
                        <ul class="wizard-list">
                            <li><strong>High confidence (90%+):</strong> Safe to act on predictions</li>
                            <li><strong>Medium confidence (70-90%):</strong> Consider as one factor in decisions</li>
                            <li><strong>Low confidence (&lt;70%):</strong> Need more data or different approach</li>
                            <li><strong>Watch uncertainty:</strong> Wide ranges suggest volatile conditions</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>✅ Example Interpretation:</h4>
                        <p><strong>Scenario:</strong> "Q4 revenue forecast"</p>
                        <ul class="wizard-list">
                            <li><strong>Trend:</strong> Positive → Revenue likely to grow</li>
                            <li><strong>Confidence:</strong> 92% → Very reliable forecast</li>
                            <li><strong>Mean Prediction:</strong> +0.15 → 15% growth expected</li>
                            <li><strong>Uncertainty:</strong> ±0.03 → Could range from +12% to +18%</li>
                            <li><strong>Action:</strong> HIGH priority recommendation: Proceed with expansion plans</li>
                        </ul>
                    </div>

                    <p style="margin-top: 20px; font-weight: 600; color: #764ba2;">
                        You're ready to create forecasts! Click "Start Forecasting" to begin. 🚀
                    </p>
                </div>

                <!-- Navigation Buttons -->
                <div class="wizard-buttons">
                    <button class="wizard-btn-prev" id="wizard-prev" disabled>← Previous</button>
                    <button class="wizard-btn-skip" id="wizard-skip">Skip Wizard</button>
                    <button class="wizard-btn-next" id="wizard-next">Next →</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>⚡ Bayesian Sophiarch</h1>
            <p>Oracle of Light • Probabilistic Forecasting with Advanced ML</p>
        </div>

        <!-- Input Section -->
        <div class="main-grid">
            <!-- Left Column: Problem Definition -->
            <div class="card">
                <h2>📊 Forecast Configuration</h2>

                <div class="form-group">
                    <label for="problem">Problem Statement</label>
                    <textarea id="problem" placeholder="Enter your forecasting problem (e.g., Q4 revenue forecast, market trend analysis)">Demo probabilistic forecast</textarea>
                </div>

                <div class="form-group">
                    <label>Forecast Horizons</label>
                    <div class="horizons-container">
                        <div class="horizon-tag active" data-horizon="1d">1 Day</div>
                        <div class="horizon-tag active" data-horizon="1w">1 Week</div>
                        <div class="horizon-tag active" data-horizon="1m">1 Month</div>
                        <div class="horizon-tag" data-horizon="3m">3 Months</div>
                        <div class="horizon-tag" data-horizon="6m">6 Months</div>
                        <div class="horizon-tag" data-horizon="1y">1 Year</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="confidence-threshold">Confidence Threshold (%)</label>
                    <input type="number" id="confidence-threshold" min="50" max="99" value="80">
                </div>

                <button class="btn" id="run-forecast" style="width: 100%; margin-top: 20px;">
                    🚀 Run Forecast
                </button>
            </div>

            <!-- Right Column: Algorithm Selection -->
            <div class="card">
                <h2>🧠 Algorithm Selection</h2>

                <div class="algorithm-grid">
                    <div class="algorithm-card selected" data-algorithm="particle_filter">
                        <h4>Particle Filter</h4>
                        <p>Sequential Monte Carlo for time-series</p>
                        <p><small>⚡ Fast • Real-time</small></p>
                    </div>

                    <div class="algorithm-card" data-algorithm="gaussian_process">
                        <h4>Gaussian Process</h4>
                        <p>Regression with uncertainty</p>
                        <p><small>📊 Smooth trends</small></p>
                    </div>

                    <div class="algorithm-card" data-algorithm="nuts_sampler">
                        <h4>NUTS Sampler</h4>
                        <p>Hamiltonian Monte Carlo</p>
                        <p><small>🎯 High quality</small></p>
                    </div>

                    <div class="algorithm-card" data-algorithm="ensemble">
                        <h4>Ensemble</h4>
                        <p>Multiple algorithms</p>
                        <p><small>🛡️ Robust</small></p>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 25px;" id="pf-params">
                    <label for="num-particles">Number of Particles</label>
                    <input type="number" id="num-particles" min="100" max="5000" step="100" value="500">
                    <small style="color: #666;">More particles = higher accuracy, slower performance</small>
                </div>

                <div class="form-group" style="display: none;" id="gp-params">
                    <label for="num-inducing">Number of Inducing Points</label>
                    <input type="number" id="num-inducing" min="50" max="500" step="50" value="100">
                    <small style="color: #666;">More points = better fit, slower performance</small>
                </div>

                <div class="form-group" style="display: none;" id="nuts-params">
                    <label for="step-size">Step Size</label>
                    <input type="number" id="step-size" min="0.001" max="0.1" step="0.001" value="0.01">
                    <small style="color: #666;">Lower = more accurate, slower</small>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="card results-section" id="results-section">
            <div class="loading" id="loading-indicator">
                <div class="spinner"></div>
                <p>Running Bayesian inference...</p>
            </div>

            <div id="error-container"></div>

            <div id="results-container" style="display: none;">
                <h2>📈 Forecast Results</h2>

                <!-- Executive Summary -->
                <div class="forecast-summary" id="forecast-summary"></div>

                <!-- Horizon Results -->
                <h3 style="margin-bottom: 15px; color: #764ba2;">Horizon Forecasts</h3>
                <div class="horizon-results" id="horizon-results"></div>

                <!-- Key Insights -->
                <h3 style="margin-bottom: 15px; color: #764ba2;">Key Insights</h3>
                <ul class="insights-list" id="insights-list"></ul>

                <!-- Recommendations -->
                <div class="recommendations">
                    <h3 style="margin-bottom: 15px; color: #764ba2;">Recommendations</h3>
                    <div id="recommendations-container"></div>
                </div>

                <!-- Export Options -->
                <div class="export-buttons">
                    <button class="btn" id="export-json">📄 Export JSON</button>
                    <button class="btn btn-secondary" id="export-markdown">📝 Export Markdown</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentAlgorithm = 'particle_filter';
        let selectedHorizons = new Set(['1d', '1w', '1m']);
        let latestResults = null;
        let currentWizardStep = 0;
        const totalWizardSteps = 5;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            setupWizard();
            checkWizardPreference();
        });

        function checkWizardPreference() {
            // Check if user has seen wizard before
            const wizardSeen = localStorage.getItem('bayesian_wizard_seen');
            if (wizardSeen === 'true') {
                document.getElementById('wizard-overlay').classList.add('hidden');
            }
        }

        function setupWizard() {
            const prevBtn = document.getElementById('wizard-prev');
            const nextBtn = document.getElementById('wizard-next');
            const skipBtn = document.getElementById('wizard-skip');

            prevBtn.addEventListener('click', () => {
                if (currentWizardStep > 0) {
                    currentWizardStep--;
                    updateWizardStep();
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentWizardStep < totalWizardSteps - 1) {
                    currentWizardStep++;
                    updateWizardStep();
                } else {
                    closeWizard();
                }
            });

            skipBtn.addEventListener('click', () => {
                closeWizard();
            });
        }

        function updateWizardStep() {
            // Hide all steps
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.classList.remove('active');
            });

            // Show current step
            document.querySelector(`.wizard-step[data-step="${currentWizardStep}"]`).classList.add('active');

            // Update progress dots
            document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index === currentWizardStep) {
                    dot.classList.add('active');
                } else if (index < currentWizardStep) {
                    dot.classList.add('completed');
                }
            });

            // Update button states
            const prevBtn = document.getElementById('wizard-prev');
            const nextBtn = document.getElementById('wizard-next');

            prevBtn.disabled = currentWizardStep === 0;

            if (currentWizardStep === totalWizardSteps - 1) {
                nextBtn.textContent = '🚀 Start Forecasting';
            } else {
                nextBtn.textContent = 'Next →';
            }
        }

        function closeWizard() {
            document.getElementById('wizard-overlay').classList.add('hidden');
            localStorage.setItem('bayesian_wizard_seen', 'true');
        }

        function setupEventListeners() {
            // Horizon selection
            document.querySelectorAll('.horizon-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const horizon = tag.dataset.horizon;
                    if (selectedHorizons.has(horizon)) {
                        selectedHorizons.delete(horizon);
                        tag.classList.remove('active');
                    } else {
                        selectedHorizons.add(horizon);
                        tag.classList.add('active');
                    }
                });
            });

            // Algorithm selection
            document.querySelectorAll('.algorithm-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.algorithm-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    currentAlgorithm = card.dataset.algorithm;
                    updateAlgorithmParams();
                });
            });

            // Run forecast
            document.getElementById('run-forecast').addEventListener('click', runForecast);

            // Export buttons
            document.getElementById('export-json').addEventListener('click', exportJSON);
            document.getElementById('export-markdown').addEventListener('click', exportMarkdown);
        }

        function updateAlgorithmParams() {
            document.getElementById('pf-params').style.display = currentAlgorithm === 'particle_filter' ? 'block' : 'none';
            document.getElementById('gp-params').style.display = currentAlgorithm === 'gaussian_process' ? 'block' : 'none';
            document.getElementById('nuts-params').style.display = currentAlgorithm === 'nuts_sampler' ? 'block' : 'none';
        }

        async function runForecast() {
            const problem = document.getElementById('problem').value.trim();
            if (!problem) {
                alert('Please enter a problem statement');
                return;
            }

            if (selectedHorizons.size === 0) {
                alert('Please select at least one forecast horizon');
                return;
            }

            const horizons = Array.from(selectedHorizons);
            const options = {
                algorithm: currentAlgorithm,
                confidence_threshold: parseInt(document.getElementById('confidence-threshold').value) / 100
            };

            // Add algorithm-specific parameters
            if (currentAlgorithm === 'particle_filter') {
                options.num_particles = parseInt(document.getElementById('num-particles').value);
            } else if (currentAlgorithm === 'gaussian_process') {
                options.num_inducing = parseInt(document.getElementById('num-inducing').value);
            } else if (currentAlgorithm === 'nuts_sampler') {
                options.step_size = parseFloat(document.getElementById('step-size').value);
            }

            const payload = { problem, horizons, options };

            // Show loading
            document.getElementById('results-section').classList.add('show');
            document.getElementById('loading-indicator').style.display = 'block';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('error-container').innerHTML = '';
            document.getElementById('run-forecast').disabled = true;

            try {
                // Run the Python runner via subprocess (simulated here - in production would use fetch to a backend)
                const results = await runPythonRunner(payload);
                latestResults = results;
                displayResults(results);
            } catch (error) {
                displayError(error.message);
            } finally {
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('run-forecast').disabled = false;
            }
        }

        async function runPythonRunner(payload) {
            // Call the backend server which runs runner.py
            try {
                const response = await fetch('/api/forecast', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.status === 'error') {
                    throw new Error(result.message || 'Unknown error from runner');
                }

                return result;
            } catch (error) {
                // If fetch fails (e.g., server not running), fall back to mock data
                console.warn('Backend not available, using mock data:', error);
                return generateMockResponse(payload);
            }
        }

        function generateMockResponse(payload) {
            // Fallback mock response when backend is unavailable
            return {
                status: 'ok',
                problem: payload.problem,
                horizons: payload.horizons,
                datasets: [{
                    source: 'synthetic',
                    num_train: 800,
                    num_test: 200,
                    feature_dim: 3
                }],
                layers: [{
                    name: currentAlgorithm === 'particle_filter' ? 'particle-filter-layer' :
                          currentAlgorithm === 'gaussian_process' ? 'gaussian-process-layer' :
                          currentAlgorithm === 'nuts_sampler' ? 'nuts-sampler-layer' : 'ensemble-layer',
                    algorithm: currentAlgorithm === 'particle_filter' ? 'AdaptiveParticleFilter' :
                               currentAlgorithm === 'gaussian_process' ? 'SparseGaussianProcess' :
                               currentAlgorithm === 'nuts_sampler' ? 'NoUTurnSampler' : 'Ensemble',
                    status: 'configured'
                }],
                outcomes: generateMockOutcomes(payload.horizons)
            };
        }

        function generateMockOutcomes(horizons) {
            const outcomes = horizons.map((horizon, idx) => ({
                horizon,
                algorithm: 'AdaptiveParticleFilter',
                mean_prediction: -0.2 - (Math.random() * 0.1),
                std_prediction: 0.05 + (Math.random() * 0.03),
                probabilities: {
                    status_quo: Math.random() * 0.3,
                    positive_shift: Math.random() * 0.3,
                    negative_shift: 0.5 + Math.random() * 0.3,
                    confidence: 0.85 + Math.random() * 0.1
                },
                effective_sample_size: 480 + Math.random() * 20
            }));

            outcomes.push({
                task: 'synthesis',
                executive_summary: {
                    overall_trend: 'neutral',
                    confidence_level: 'high',
                    confidence_score: 0.92 + Math.random() * 0.05,
                    most_likely_outcome: 'negative_shift',
                    prediction_range: {
                        low: -0.28,
                        high: -0.15,
                        expected: -0.21
                    },
                    key_insights: [
                        `Predictions range from -0.28 to -0.15 with mean -0.21`,
                        `High confidence in predictions with strong algorithm consensus`,
                        `${horizons.length} horizons analyzed with ${currentAlgorithm.replace('_', ' ')}`
                    ]
                },
                recommendations: [
                    {
                        priority: 'high',
                        action: 'Proceed with planned actions - high confidence in forecasts',
                        rationale: 'Overall confidence score: 0.94'
                    },
                    {
                        priority: 'medium',
                        action: 'Monitor actual outcomes and update models regularly',
                        rationale: 'Continuous learning improves forecast accuracy'
                    }
                ]
            });

            return outcomes;
        }

        function displayResults(results) {
            const synthesis = results.outcomes.find(o => o.task === 'synthesis');
            const horizonData = results.outcomes.filter(o => o.horizon);

            if (!synthesis) {
                displayError('No synthesis data in results');
                return;
            }

            // Executive Summary
            const summary = synthesis.executive_summary;
            document.getElementById('forecast-summary').innerHTML = `
                <h3>📊 Executive Summary</h3>
                <div class="summary-grid">
                    <div class="summary-stat">
                        <div class="label">Overall Trend</div>
                        <div class="value">${summary.overall_trend.toUpperCase()}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="label">Confidence Level</div>
                        <div class="value">${summary.confidence_level.toUpperCase()}</div>
                    </div>
                    <div class="summary-stat">
                        <div class="label">Confidence Score</div>
                        <div class="value">${(summary.confidence_score * 100).toFixed(1)}%</div>
                    </div>
                    <div class="summary-stat">
                        <div class="label">Prediction Range</div>
                        <div class="value">${summary.prediction_range.low.toFixed(3)} to ${summary.prediction_range.high.toFixed(3)}</div>
                    </div>
                </div>
            `;

            // Horizon Results
            const horizonHTML = horizonData.map(h => `
                <div class="horizon-card">
                    <h4>⏱️ ${h.horizon.toUpperCase()} Forecast</h4>
                    <div class="stat-row">
                        <span class="stat-label">Mean Prediction</span>
                        <span class="stat-value">${h.mean_prediction.toFixed(3)}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Uncertainty (±)</span>
                        <span class="stat-value">${h.std_prediction.toFixed(3)}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Confidence</span>
                        <span class="stat-value">${(h.probabilities.confidence * 100).toFixed(1)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${h.probabilities.confidence * 100}%"></div>
                    </div>
                    <div class="stat-row" style="margin-top: 10px;">
                        <span class="stat-label">Effective Samples</span>
                        <span class="stat-value">${Math.round(h.effective_sample_size)}</span>
                    </div>
                </div>
            `).join('');
            document.getElementById('horizon-results').innerHTML = horizonHTML;

            // Key Insights
            const insightsHTML = summary.key_insights.map(insight =>
                `<li>💡 ${insight}</li>`
            ).join('');
            document.getElementById('insights-list').innerHTML = insightsHTML;

            // Recommendations
            const recommendationsHTML = synthesis.recommendations.map(rec => `
                <div class="recommendation-card ${rec.priority}">
                    <span class="badge ${rec.priority}">${rec.priority.toUpperCase()}</span>
                    <h5>${rec.action}</h5>
                    <p style="color: #666; margin: 0;">${rec.rationale}</p>
                </div>
            `).join('');
            document.getElementById('recommendations-container').innerHTML = recommendationsHTML;

            document.getElementById('results-container').style.display = 'block';
        }

        function displayError(message) {
            document.getElementById('error-container').innerHTML = `
                <div class="error-message">
                    <strong>❌ Error:</strong> ${message}
                </div>
            `;
            document.getElementById('results-container').style.display = 'none';
        }

        function exportJSON() {
            if (!latestResults) return;
            const blob = new Blob([JSON.stringify(latestResults, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `forecast_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportMarkdown() {
            if (!latestResults) return;
            const synthesis = latestResults.outcomes.find(o => o.task === 'synthesis');
            if (!synthesis) return;

            const md = `# Bayesian Sophiarch Forecast Report

## Problem
${latestResults.problem}

**Generated:** ${new Date().toISOString()}

---

## Executive Summary

- **Overall Trend:** ${synthesis.executive_summary.overall_trend.toUpperCase()}
- **Confidence Level:** ${synthesis.executive_summary.confidence_level.toUpperCase()}
- **Confidence Score:** ${(synthesis.executive_summary.confidence_score * 100).toFixed(2)}%

### Prediction Range
- **Low:** ${synthesis.executive_summary.prediction_range.low.toFixed(3)}
- **Expected:** ${synthesis.executive_summary.prediction_range.expected.toFixed(3)}
- **High:** ${synthesis.executive_summary.prediction_range.high.toFixed(3)}

---

## Key Insights

${synthesis.executive_summary.key_insights.map(i => `- ${i}`).join('\n')}

---

## Recommendations

${synthesis.recommendations.map((r, idx) => `
### ${idx + 1}. ${r.action}
**Priority:** ${r.priority.toUpperCase()}
**Rationale:** ${r.rationale}
`).join('\n')}
`;

            const blob = new Blob([md], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `forecast_${Date.now()}.md`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
